@use "@imarc/pronto/resources/styles/imported" as *;

.cards {
  $b: &;

  --columns: 1;
  --gap: var(--root-gap, 16px);
  --min-column: 240px;

  display: grid;
  gap: var(--gap);
  grid-template-columns: repeat(var(--columns), 1fr);

  // Allow auto-fit wrapping before fixed columns kick in
  @include at(sm) {
    grid-template-columns: repeat(
      auto-fit,
      minmax(min(100%, var(--min-column)), 1fr)
    );
  }

  // Responsive defaults: 1 mobile, 2 tablet+
  @include at(md) {
    --columns: 2;
  }

  @include at(lg) {
    grid-template-columns: repeat(var(--columns), 1fr);
  }

  // Column modifiers (2-5 columns on tablet+)
  @for $i from 2 through 5 {
    &.-columns-#{$i} {
      @include at(md) {
        --columns: #{$i};
      }
    }
  }


  // Center orphan cards using doubled grid columns
  // Cards span 2 columns, orphans positioned to center
  &.-centered {
    // Keep auto-fit on small screens, but center the rows
    @include at(sm) {
      grid-template-columns: repeat(
        auto-fit,
        minmax(min(100%, var(--min-column)), max-content)
      );
      justify-content: center;
    }

    // 3 visual columns = 6 grid columns (default for -centered)
    @include at(md) {
      > .card {
        grid-column: span 2;
      }

      grid-template-columns: repeat(6, 1fr);

      // Center 1 or 2 orphans in a 3-column layout (works for any count)
      > .card:nth-child(3n + 1):nth-last-child(1) {
        grid-column: 3 / 5;
      }
      > .card:nth-child(3n + 1):nth-last-child(2) {
        grid-column: 2 / 4;
      }
      > .card:nth-child(3n + 2):nth-last-child(1) {
        grid-column: 4 / 6;
      }
    }

    // 4 visual columns = 8 grid columns
    &.-columns-4 {
      @include at(lg) {
        grid-template-columns: repeat(8, 1fr);

        // Center 1-3 orphans in a 4-column layout (works for any count)
        > .card:nth-child(4n + 1):nth-last-child(1) {
          grid-column: 4 / 6;
        }
        > .card:nth-child(4n + 1):nth-last-child(2) {
          grid-column: 3 / 5;
        }
        > .card:nth-child(4n + 2):nth-last-child(1) {
          grid-column: 5 / 7;
        }
        > .card:nth-child(4n + 1):nth-last-child(3) {
          grid-column: 2 / 4;
        }
        > .card:nth-child(4n + 2):nth-last-child(2) {
          grid-column: 4 / 6;
        }
        > .card:nth-child(4n + 3):nth-last-child(1) {
          grid-column: 6 / 8;
        }
      }
    }

    // 5 visual columns = 10 grid columns
    &.-columns-5 {
      @include at(lg) {
        grid-template-columns: repeat(10, 1fr);
        // Center 1-4 orphans in a 5-column layout (works for any count)
        > .card:nth-child(5n + 1):nth-last-child(1) {
          grid-column: 5 / 7;
        }
        > .card:nth-child(5n + 1):nth-last-child(2) {
          grid-column: 4 / 6;
        }
        > .card:nth-child(5n + 2):nth-last-child(1) {
          grid-column: 6 / 8;
        }
        > .card:nth-child(5n + 1):nth-last-child(3) {
          grid-column: 3 / 5;
        }
        > .card:nth-child(5n + 2):nth-last-child(2) {
          grid-column: 5 / 7;
        }
        > .card:nth-child(5n + 3):nth-last-child(1) {
          grid-column: 7 / 9;
        }
        > .card:nth-child(5n + 1):nth-last-child(4) {
          grid-column: 2 / 4;
        }
        > .card:nth-child(5n + 2):nth-last-child(3) {
          grid-column: 4 / 6;
        }
        > .card:nth-child(5n + 3):nth-last-child(2) {
          grid-column: 6 / 8;
        }
        > .card:nth-child(5n + 4):nth-last-child(1) {
          grid-column: 8 / 10;
        }
      }
    }
  }
}

